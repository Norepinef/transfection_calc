<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расчет трансфекции</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            background-color: #f2f2f2;
            padding: 15px;
            border-radius: 8px;
        }
        .help {
            margin-top: 30px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        .help h3 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Расчет трансфекции на основе плазмид</h1>

        <!-- Ввод параметров -->
        <label for="working_volume">Объем наработки (xT175):</label>
        <input type="number" id="working_volume" value="8">

        <label for="flask_type">Тип флакона:</label>
        <select id="flask_type">
            <option value="T175">T175</option>
            <option value="КРУГЛЫЕ10СМ">КРУГЛЫЕ10СМ</option>
            <option value="5-level cellstack">5-level cellstack</option>
            <option value="10-level cellstack">10-level cellstack</option>
        </select>

        <!-- Ввод размеров плазмид -->
        <h3>Длина плазмид (в парах оснований):</h3>
        <label for="L1">Длина плазмиды pAAV-Helper (базовые пары):</label>
        <input type="number" id="L1" value="11635">

        <label for="L2">Длина плазмиды AAV2/6 (базовые пары):</label>
        <input type="number" id="L2" value="8369">

        <label for="L3">Длина плазмиды AAV-CMV-EGFP (базовые пары):</label>
        <input type="number" id="L3" value="7285">

        <!-- Ввод молекулярного соотношения -->
        <h3>Молекулярное соотношение плазмид:</h3>
        <label for="M1">Соотношение pAAV-Helper:</label>
        <input type="number" id="M1" value="1">

        <label for="M2">Соотношение AAV2/6:</label>
        <input type="number" id="M2" value="1">

        <label for="M3">Соотношение AAV-CMV-EGFP:</label>
        <input type="number" id="M3" value="1">

        <label for="conc1">Концентрация pAAV-Helper (мкг/мкл):</label>
        <input type="number" id="conc1" value="1.1">

        <label for="conc2">Концентрация AAV2/6 (мкг/мкл):</label>
        <input type="number" id="conc2" value="2.335">

        <label for="conc3">Концентрация AAV-CMV-EGFP (мкг/мкл):</label>
        <input type="number" id="conc3" value="1.01">

        <button onclick="calculate()">Выполнить расчет</button>

        <!-- Вывод результата -->
        <div class="result" id="result"></div>

        <!-- Справка по расчетам -->
        <div class="help">
            <h3>Принципы расчета:</h3>
            <p>1. Длина плазмид рассчитывается в парах оснований.</p>
            <p>2. Молекулярная масса ДНК на основе длины плазмиды умножается на 660 г/моль на пару оснований.</p>
            <p>3. Молекулярное соотношение плазмид влияет на итоговое количество ДНК, которое нужно использовать для трансфекции.</p>
            <p>4. Количество плазмид рассчитывается на основе площади флакона и концентрации ДНК в клеточной культуре.</p>
            <p>5. Объемы плазмид и общей среды рассчитываются с учетом их концентраций и объема.</p>
        </div>
    </div>

    <script>
        function calculate() {
            // Ввод параметров
            const L1 = parseFloat(document.getElementById('L1').value); // Длина плазмиды pAAV-Helper
            const L2 = parseFloat(document.getElementById('L2').value); // Длина плазмиды AAV2/6
            const L3 = parseFloat(document.getElementById('L3').value); // Длина плазмиды AAV-CMV-EGFP

            const M1 = parseFloat(document.getElementById('M1').value); // Соотношение pAAV-Helper
            const M2 = parseFloat(document.getElementById('M2').value); // Соотношение AAV2/6
            const M3 = parseFloat(document.getElementById('M3').value); // Соотношение AAV-CMV-EGFP

            const working_volume = parseFloat(document.getElementById('working_volume').value);
            const flask_type = document.getElementById('flask_type').value;
            const conc1 = parseFloat(document.getElementById('conc1').value);
            const conc2 = parseFloat(document.getElementById('conc2').value);
            const conc3 = parseFloat(document.getElementById('conc3').value);

            // Устанавливаем коэффициент K в зависимости от типа флакона
            let K;
            if (flask_type === "T175") {
                K = 1;
            } else if (flask_type === "КРУГЛЫЕ10СМ") {
                K = 0.6;
            } else if (flask_type === "5-level cellstack") {
                K = 18;
            } else if (flask_type === "10-level cellstack") {
                K = 36;
            }

            // Кол-во ДНК на 1 мл КЖ
            const DNA_per_ml = 1.5;
            const medium_per_flask = 30;
            const TF_mixture_volume_per_flask = 3;
            const PEI_to_DNA = 3;

            // Расчет количества ДНК с учетом молекулярной массы
            const V1 = L1 * 660 / Math.pow(10, 6);
            const V2 = L2 * 660 / Math.pow(10, 6);
            const V3 = L3 * 660 / Math.pow(10, 6);

            const DNA1 = V1 * M1;
            const DNA2 = V2 * M2;
            const DNA3 = V3 * M3;

            // Общее количество ДНК
            const total_DNA = DNA1 + DNA2 + DNA3;

            // Расчет суммарного количества плазмид
            const total_plasmid = working_volume * K * DNA_per_ml * medium_per_flask;

            // Суммарное количество PEI
            const total_PEI = total_plasmid * PEI_to_DNA;

            // Коэффициент для расчета
            const coefficient = total_plasmid / total_DNA;

            // Расчет на все чашки
            const X1 = coefficient * DNA1;
            const X2 = coefficient * DNA2;
            const X3 = coefficient * DNA3;

            // Объем плазмид, мкл
            const Volume1 = X1 / conc1;
            const Volume2 = X2 / conc2;
            const Volume3 = X3 / conc3;

            // Общий объем плазмид, мкл
            const total_plasmid_volume = Volume1 + Volume2 + Volume3;

            // Сколько суммарно среды к ДНК, мл
            const media_for_DNA = (working_volume * K * TF_mixture_volume_per_flask / 2 - total_plasmid_volume * 0.001);

            // Сколько суммарно среды к PEI, мл
            const media_for_PEI = (working_volume * K * TF_mixture_volume_per_flask / 2 - total_PEI * 0.001);

            // Объем микса с DMEM на чашку
            const DMEM_per_dish = (media_for_DNA + total_plasmid_volume * 0.001 + media_for_PEI + total_PEI * 0.001) / working_volume;

            // Проверка объема микса на чашку
            const mix_check = 3; // Общий объем микса на флакон, мл

            // Суммарно микс теоретически
            const total_mix_theoretical = mix_check * working_volume;

            // Формируем вывод
            let resultText = `ДНК всего (мкг): ${total_DNA.toFixed(2)}\n`;
            resultText += `Общее количество плазмид: ${total_plasmid}\n`;
            resultText += `Суммарное количество PEI, мкл: ${total_PEI.toFixed(2)}\n`;
            resultText += `Общий объем плазмид, мкл: ${total_plasmid_volume.toFixed(2)}\n`;
            resultText += `Сколько суммарно среды к ДНК, мл: ${media_for_DNA.toFixed(1)}\n`;
            resultText += `Сколько суммарно среды к PEI, мл: ${media_for_PEI.toFixed(1)}\n`;
            resultText += `Объем микса с DMEM на чашку: ${DMEM_per_dish.toFixed(2)}\n`;
            resultText += `Проверка объема микса на чашку: ${mix_check}\n`;
            resultText += `Суммарно микс теоретически: ${total_mix_theoretical}\n`;

            resultText += `\nОбъем каждой плазмиды (мкл):\n`;
            resultText += `Объем pAAV-Helper: ${Volume1.toFixed(2)} мкл\n`;
            resultText += `Объем AAV2/6: ${Volume2.toFixed(2)} мкл\n`;
            resultText += `Объем AAV-CMV-EGFP: ${Volume3.toFixed(2)} мкл\n`;

            document.getElementById("result").textContent = resultText;
        }
    </script>

</body>
</html>
